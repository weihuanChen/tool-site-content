# æŸ¥è¯¢ç”¨ä¾‹æ€»ç»“ä¸ç´¢å¼•ä¼˜åŒ–æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº† Strapi API çš„å¸¸ç”¨æŸ¥è¯¢ç”¨ä¾‹ï¼Œå¹¶ä¸ºå‰ç«¯å¼€å‘æä¾›ç´¢å¼•ä¼˜åŒ–å»ºè®®ã€‚åŸºäºå®é™…æµ‹è¯•å’Œæ•°æ®ç»“æ„åˆ†æï¼Œå¸®åŠ©å‰ç«¯å¼€å‘è€…è¿›è¡Œé«˜æ•ˆçš„æŸ¥è¯¢ä¼˜åŒ–ã€‚

## åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:1337/api`
- **Content-Type**: `application/json`
- **è®¤è¯æ–¹å¼**: JWT Token / API Token

## æ–‡ç« æŸ¥è¯¢ç”¨ä¾‹ (Articles)

### 1. åŸºç¡€æŸ¥è¯¢

#### 1.1 è·å–æ‰€æœ‰æ–‡ç« 
```http
GET /api/articles
```

**ç´¢å¼•å»ºè®®**: 
- âœ… `publishedAt` (æ—¶é—´æ’åº)
- âœ… `createdAt` (åˆ›å»ºæ—¶é—´)
- âœ… `updatedAt` (æ›´æ–°æ—¶é—´)

**æ€§èƒ½ä¼˜åŒ–**:
- é»˜è®¤æŒ‰ `publishedAt` é™åºæ’åˆ—
- å»ºè®®è®¾ç½®åˆç†çš„åˆ†é¡µå¤§å° (10-25æ¡)

#### 1.2 åˆ†é¡µæŸ¥è¯¢
```http
GET /api/articles?pagination[page]=1&pagination[pageSize]=10
```

**ç´¢å¼•å»ºè®®**:
- âœ… `publishedAt` (ä¸»æ’åºå­—æ®µ)
- âœ… `id` (å”¯ä¸€æ ‡è¯†)

**æ€§èƒ½ä¼˜åŒ–**:
- ä½¿ç”¨ `withCount=true` æ—¶æ³¨æ„æ€§èƒ½å½±å“
- å»ºè®®ç¼“å­˜åˆ†é¡µç»“æœ

### 2. è¿‡æ»¤æŸ¥è¯¢

#### 2.1 æŒ‰è¯­è¨€è¿‡æ»¤
```http
GET /api/articles?filters[language][$eq]=ja
GET /api/articles?filters[language][$in]=ja,en,zh
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `language` (æšä¸¾å­—æ®µï¼ŒæŸ¥è¯¢é¢‘ç¹)
- âœ… `publishedAt` (é…åˆæ’åº)

**æ€§èƒ½ä¼˜åŒ–**:
- è¯­è¨€è¿‡æ»¤æ˜¯æœ€å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶
- å»ºè®®åœ¨æ•°æ®åº“å±‚é¢å»ºç«‹å¤åˆç´¢å¼•: `(language, publishedAt)`

#### 2.2 æŒ‰æ ‡é¢˜æœç´¢
```http
GET /api/articles?filters[title][$contains]=strapi
GET /api/articles?filters[title][$containsi]=strapi
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `title` (å…¨æ–‡æœç´¢)
- è€ƒè™‘ä½¿ç”¨å…¨æ–‡ç´¢å¼•æˆ–æœç´¢å¼•æ“

**æ€§èƒ½ä¼˜åŒ–**:
- é¿å…åœ¨ `title` å­—æ®µä¸Šä½¿ç”¨ `$contains` è¿›è¡Œå¤§é‡æ•°æ®æŸ¥è¯¢
- å»ºè®®ä½¿ç”¨ `$containsi` (ä¸åŒºåˆ†å¤§å°å†™) æé«˜ç”¨æˆ·ä½“éªŒ

#### 2.3 æŒ‰æ ‡ç­¾è¿‡æ»¤
```http
GET /api/articles?filters[tags][$contains]=æ•°å­¦
GET /api/articles?filters[tags][$containsi]=æ•°å­¦
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `tags` (JSONå­—æ®µï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†)
- è€ƒè™‘ä½¿ç”¨ä¸“é—¨çš„æ ‡ç­¾ç´¢å¼•è¡¨

**æ€§èƒ½ä¼˜åŒ–**:
- JSONå­—æ®µæŸ¥è¯¢æ€§èƒ½è¾ƒä½ï¼Œå»ºè®®é™åˆ¶ç»“æœæ•°é‡
- è€ƒè™‘å°†æ ‡ç­¾æå–ä¸ºç‹¬ç«‹çš„å…³ç³»è¡¨

#### 2.4 æŒ‰ä½œè€…è¿‡æ»¤
```http
GET /api/articles?filters[author][id][$eq]=1
GET /api/articles?filters[author][username][$eq]=author1
```

**ç´¢å¼•å»ºè®®**:
- âœ… `author` (å…³è”å­—æ®µ)
- âœ… `author.id` (å¤–é”®ç´¢å¼•)

**æ€§èƒ½ä¼˜åŒ–**:
- å…³è”æŸ¥è¯¢éœ€è¦JOINæ“ä½œï¼Œå»ºè®®é™åˆ¶ç»“æœæ•°é‡
- è€ƒè™‘é¢„åŠ è½½ä½œè€…ä¿¡æ¯

#### 2.5 æŒ‰åŸŸåè¿‡æ»¤
```http
GET /api/articles?filters[domain][$eq]=https://16to10.com
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `domain` (å”¯ä¸€å­—æ®µï¼ŒæŸ¥è¯¢é¢‘ç¹)
- âœ… `publishedAt` (é…åˆæ’åº)

**æ€§èƒ½ä¼˜åŒ–**:
- åŸŸåè¿‡æ»¤é€šå¸¸ç”¨äºå¤šç«™ç‚¹åœºæ™¯
- å»ºè®®å»ºç«‹å¤åˆç´¢å¼•: `(domain, publishedAt)`

#### 2.6 æŒ‰å‘å¸ƒæ—¶é—´èŒƒå›´è¿‡æ»¤
```http
GET /api/articles?filters[publishedAt][$gte]=2023-01-01
GET /api/articles?filters[publishedAt][$lte]=2023-12-31
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `publishedAt` (æ—¶é—´èŒƒå›´æŸ¥è¯¢)
- âœ… `language` (é…åˆå…¶ä»–è¿‡æ»¤æ¡ä»¶)

**æ€§èƒ½ä¼˜åŒ–**:
- æ—¶é—´èŒƒå›´æŸ¥è¯¢æ€§èƒ½è‰¯å¥½
- å»ºè®®ç»“åˆå…¶ä»–è¿‡æ»¤æ¡ä»¶ä½¿ç”¨

### 3. æ’åºæŸ¥è¯¢

#### 3.1 æŒ‰æ—¶é—´æ’åº
```http
GET /api/articles?sort=publishedAt:desc
GET /api/articles?sort=createdAt:desc
GET /api/articles?sort=updatedAt:desc
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `publishedAt` (ä¸»è¦æ’åºå­—æ®µ)
- âœ… `createdAt` (åˆ›å»ºæ—¶é—´æ’åº)
- âœ… `updatedAt` (æ›´æ–°æ—¶é—´æ’åº)

#### 3.2 æŒ‰æ ‡é¢˜æ’åº
```http
GET /api/articles?sort=title:asc
```

**ç´¢å¼•å»ºè®®**:
- âœ… `title` (å­—ç¬¦ä¸²æ’åº)
- æ³¨æ„å›½é™…åŒ–æ’åºè§„åˆ™

#### 3.3 å¤šå­—æ®µæ’åº
```http
GET /api/articles?sort[0]=language:asc&sort[1]=publishedAt:desc
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: å¤åˆç´¢å¼• `(language, publishedAt)`
- æŒ‰ç…§æ’åºå­—æ®µé¡ºåºå»ºç«‹ç´¢å¼•

### 4. å…³è”æŸ¥è¯¢

#### 4.1 é¢„åŠ è½½ä½œè€…ä¿¡æ¯
```http
GET /api/articles?populate=author
```

**ç´¢å¼•å»ºè®®**:
- âœ… `author` (å¤–é”®ç´¢å¼•)
- âœ… `author.id` (ä¸»é”®ç´¢å¼•)

**æ€§èƒ½ä¼˜åŒ–**:
- é¿å…æ·±åº¦åµŒå¥—çš„å…³è”æŸ¥è¯¢
- è€ƒè™‘ä½¿ç”¨å­—æ®µé€‰æ‹©å‡å°‘æ•°æ®ä¼ è¾“

#### 4.2 é¢„åŠ è½½å°é¢å›¾ç‰‡
```http
GET /api/articles?populate=coverImage
```

**ç´¢å¼•å»ºè®®**:
- âœ… `coverImage` (åª’ä½“å­—æ®µç´¢å¼•)

### 5. å­—æ®µé€‰æ‹©

#### 5.1 é€‰æ‹©ç‰¹å®šå­—æ®µ
```http
GET /api/articles?fields[0]=title&fields[1]=description&fields[2]=publishedAt
```

**æ€§èƒ½ä¼˜åŒ–**:
- å‡å°‘ç½‘ç»œä¼ è¾“é‡
- æé«˜æŸ¥è¯¢æ€§èƒ½

### 6. å¤åˆæŸ¥è¯¢ç¤ºä¾‹

#### 6.1 å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢
```http
GET /api/articles?filters[language][$eq]=ja&filters[domain][$eq]=https://16to10.com&filters[publishedAt][$gte]=2023-01-01&sort=publishedAt:desc&pagination[page]=1&pagination[pageSize]=10&populate=author
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: å¤åˆç´¢å¼• `(language, domain, publishedAt)`
- âœ… `author` (å…³è”ç´¢å¼•)

**æ€§èƒ½ä¼˜åŒ–**:
- è¿™æ˜¯æœ€å¸¸ç”¨çš„æŸ¥è¯¢æ¨¡å¼
- å»ºè®®å»ºç«‹ä¸“é—¨çš„å¤åˆç´¢å¼•

#### 6.2 æœç´¢å’Œè¿‡æ»¤ç»„åˆ
```http
GET /api/articles?filters[title][$containsi]=æ•°å­¦&filters[language][$eq]=ja&sort=publishedAt:desc
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `language` (è¿‡æ»¤æ¡ä»¶)
- âœ… `publishedAt` (æ’åºå­—æ®µ)
- âš ï¸ `title` (å…¨æ–‡æœç´¢ï¼Œæ€§èƒ½è¾ƒä½)

## ä½œè€…æŸ¥è¯¢ç”¨ä¾‹ (Authors)

### 1. åŸºç¡€æŸ¥è¯¢

#### 1.1 è·å–æ‰€æœ‰ä½œè€…
```http
GET /api/authors
```

**ç´¢å¼•å»ºè®®**:
- âœ… `createdAt` (æ—¶é—´æ’åº)
- âœ… `username` (å”¯ä¸€æ ‡è¯†)

#### 1.2 æŒ‰ç”¨æˆ·åæŸ¥è¯¢
```http
GET /api/authors?filters[username][$eq]=author1
```

**ç´¢å¼•å»ºè®®**:
- ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `username` (å”¯ä¸€å­—æ®µï¼ŒæŸ¥è¯¢é¢‘ç¹)

#### 1.3 æŒ‰æ˜¾ç¤ºåç§°æŸ¥è¯¢
```http
GET /api/authors?filters[displayName][$contains]=ä½œè€…
```

**ç´¢å¼•å»ºè®®**:
- âœ… `displayName` (å­—ç¬¦ä¸²æœç´¢)

### 2. å…³è”æŸ¥è¯¢

#### 2.1 é¢„åŠ è½½æ–‡ç« åˆ—è¡¨
```http
GET /api/authors?populate=articles
```

**ç´¢å¼•å»ºè®®**:
- âœ… `articles` (å…³è”å­—æ®µ)
- âš ï¸ æ³¨æ„N+1æŸ¥è¯¢é—®é¢˜

## ç´¢å¼•ä¼˜åŒ–å»ºè®®

### 1. é«˜ä¼˜å…ˆçº§ç´¢å¼•

#### æ–‡ç« è¡¨ (articles)
```sql
-- ä¸»è¦å¤åˆç´¢å¼•
CREATE INDEX idx_articles_language_published ON articles(language, publishedAt DESC);
CREATE INDEX idx_articles_domain_published ON articles(domain, publishedAt DESC);
CREATE INDEX idx_articles_language_domain_published ON articles(language, domain, publishedAt DESC);

-- å•å­—æ®µç´¢å¼•
CREATE INDEX idx_articles_published_at ON articles(publishedAt DESC);
CREATE INDEX idx_articles_created_at ON articles(createdAt DESC);
CREATE INDEX idx_articles_updated_at ON articles(updatedAt DESC);
CREATE INDEX idx_articles_title ON articles(title);
CREATE INDEX idx_articles_slug ON articles(slug);
CREATE INDEX idx_articles_author_id ON articles(author_id);

-- å…¨æ–‡ç´¢å¼• (å¦‚æœæ”¯æŒ)
CREATE FULLTEXT INDEX idx_articles_title_fulltext ON articles(title);
CREATE FULLTEXT INDEX idx_articles_content_fulltext ON articles(content);
```

#### ä½œè€…è¡¨ (authors)
```sql
-- ä¸»è¦ç´¢å¼•
CREATE INDEX idx_authors_username ON authors(username);
CREATE INDEX idx_authors_email ON authors(email);
CREATE INDEX idx_authors_created_at ON authors(createdAt DESC);
```

### 2. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

#### 2.1 åˆ†é¡µä¼˜åŒ–
```javascript
// æ¨èçš„åˆ†é¡µæŸ¥è¯¢
const getArticles = async (page = 1, pageSize = 10, filters = {}) => {
  const params = new URLSearchParams({
    'pagination[page]': page,
    'pagination[pageSize]': pageSize,
    'pagination[withCount]': 'true',
    ...filters
  });
  
  return fetch(`/api/articles?${params}`);
};
```

#### 2.2 ç¼“å­˜ç­–ç•¥
```javascript
// å»ºè®®çš„ç¼“å­˜ç­–ç•¥
const cacheConfig = {
  // æ–‡ç« åˆ—è¡¨ç¼“å­˜ 5 åˆ†é’Ÿ
  articles: { ttl: 300 },
  // å•ç¯‡æ–‡ç« ç¼“å­˜ 30 åˆ†é’Ÿ
  article: { ttl: 1800 },
  // ä½œè€…ä¿¡æ¯ç¼“å­˜ 1 å°æ—¶
  author: { ttl: 3600 }
};
```

#### 2.3 æŸ¥è¯¢é™åˆ¶
```javascript
// æ¨èçš„æŸ¥è¯¢é™åˆ¶
const queryLimits = {
  maxPageSize: 50,        // æœ€å¤§åˆ†é¡µå¤§å°
  maxSearchLength: 100,   // æœ€å¤§æœç´¢é•¿åº¦
  maxTagsCount: 10,       // æœ€å¤§æ ‡ç­¾æ•°é‡
  maxPopulateDepth: 2     // æœ€å¤§å…³è”æ·±åº¦
};
```

### 3. ç›‘æ§æŒ‡æ ‡

#### 3.1 æ€§èƒ½æŒ‡æ ‡
- æŸ¥è¯¢å“åº”æ—¶é—´ < 200ms
- æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡ < 80%
- ç¼“å­˜å‘½ä¸­ç‡ > 85%

#### 3.2 æ…¢æŸ¥è¯¢ç›‘æ§
```sql
-- ç›‘æ§æ…¢æŸ¥è¯¢
SELECT 
  query,
  avg_time,
  calls,
  total_time
FROM pg_stat_statements 
WHERE avg_time > 1000  -- è¶…è¿‡1ç§’çš„æŸ¥è¯¢
ORDER BY avg_time DESC;
```

## å‰ç«¯æŸ¥è¯¢æœ€ä½³å®è·µ

### 1. æŸ¥è¯¢æ„å»ºå™¨
```javascript
class QueryBuilder {
  constructor(baseUrl = '/api') {
    this.baseUrl = baseUrl;
    this.params = new URLSearchParams();
  }
  
  // æ·»åŠ è¿‡æ»¤æ¡ä»¶
  filter(field, operator, value) {
    this.params.append(`filters[${field}][${operator}]`, value);
    return this;
  }
  
  // æ·»åŠ æ’åº
  sort(field, direction = 'asc') {
    this.params.append('sort', `${field}:${direction}`);
    return this;
  }
  
  // æ·»åŠ åˆ†é¡µ
  paginate(page, pageSize) {
    this.params.append('pagination[page]', page);
    this.params.append('pagination[pageSize]', pageSize);
    return this;
  }
  
  // æ·»åŠ å…³è”
  populate(relations) {
    if (Array.isArray(relations)) {
      relations.forEach((rel, index) => {
        this.params.append(`populate[${index}]`, rel);
      });
    } else {
      this.params.append('populate', relations);
    }
    return this;
  }
  
  // æ„å»ºURL
  build(endpoint) {
    return `${this.baseUrl}${endpoint}?${this.params.toString()}`;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const query = new QueryBuilder()
  .filter('language', '$eq', 'ja')
  .filter('domain', '$eq', 'https://16to10.com')
  .sort('publishedAt', 'desc')
  .paginate(1, 10)
  .populate(['author'])
  .build('/articles');
```

### 2. ç¼“å­˜ç®¡ç†
```javascript
class CacheManager {
  constructor() {
    this.cache = new Map();
    this.ttl = new Map();
  }
  
  set(key, value, ttl = 300000) { // é»˜è®¤5åˆ†é’Ÿ
    this.cache.set(key, value);
    this.ttl.set(key, Date.now() + ttl);
  }
  
  get(key) {
    if (this.ttl.get(key) < Date.now()) {
      this.cache.delete(key);
      this.ttl.delete(key);
      return null;
    }
    return this.cache.get(key);
  }
  
  clear() {
    this.cache.clear();
    this.ttl.clear();
  }
}
```

### 3. é”™è¯¯å¤„ç†
```javascript
class APIError extends Error {
  constructor(message, status, details) {
    super(message);
    this.name = 'APIError';
    this.status = status;
    this.details = details;
  }
}

const handleAPIResponse = async (response) => {
  if (!response.ok) {
    const error = await response.json();
    throw new APIError(
      error.error?.message || 'APIè¯·æ±‚å¤±è´¥',
      error.error?.status || response.status,
      error.error?.details
    );
  }
  return response.json();
};
```

## æ€»ç»“

### å…³é”®ç´¢å¼•ä¼˜å…ˆçº§
1. ğŸ”¥ **æœ€é«˜ä¼˜å…ˆçº§**: `language`, `domain`, `publishedAt` å¤åˆç´¢å¼•
2. ğŸ”¥ **é«˜ä¼˜å…ˆçº§**: `title` å…¨æ–‡ç´¢å¼•, `username` å”¯ä¸€ç´¢å¼•
3. âœ… **ä¸­ä¼˜å…ˆçº§**: å•å­—æ®µæ—¶é—´ç´¢å¼•, å¤–é”®ç´¢å¼•
4. âš ï¸ **ä½ä¼˜å…ˆçº§**: JSONå­—æ®µç´¢å¼• (æ€§èƒ½è¾ƒä½)

### æŸ¥è¯¢ä¼˜åŒ–è¦ç‚¹
1. ä¼˜å…ˆä½¿ç”¨ç´¢å¼•å­—æ®µè¿›è¡Œè¿‡æ»¤
2. åˆç†è®¾ç½®åˆ†é¡µå¤§å° (10-25æ¡)
3. é¿å…æ·±åº¦å…³è”æŸ¥è¯¢
4. ä½¿ç”¨å­—æ®µé€‰æ‹©å‡å°‘æ•°æ®ä¼ è¾“
5. å®æ–½é€‚å½“çš„ç¼“å­˜ç­–ç•¥

### ç›‘æ§é‡ç‚¹
1. æŸ¥è¯¢å“åº”æ—¶é—´
2. æ•°æ®åº“è¿æ¥ä½¿ç”¨ç‡
3. ç¼“å­˜å‘½ä¸­ç‡
4. æ…¢æŸ¥è¯¢è¯†åˆ«

é€šè¿‡éµå¾ªè¿™äº›å»ºè®®ï¼Œå¯ä»¥æ˜¾è‘—æé«˜APIæŸ¥è¯¢æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚
