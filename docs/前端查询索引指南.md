# å‰ç«¯æŸ¥è¯¢ç´¢å¼•æŒ‡å—

## å¿«é€Ÿå‚è€ƒ

### ğŸ”¥ é«˜ä¼˜å…ˆçº§æŸ¥è¯¢å­—æ®µ (å»ºè®®å»ºç«‹ç´¢å¼•)

| å­—æ®µ | ç±»å‹ | æŸ¥è¯¢é¢‘ç‡ | ç´¢å¼•å»ºè®® | ç¤ºä¾‹æŸ¥è¯¢ |
|------|------|----------|----------|----------|
| `language` | enum | æé«˜ | å¤åˆç´¢å¼• | `filters[language][$eq]=ja` |
| `domain` | string | é«˜ | å¤åˆç´¢å¼• | `filters[domain][$eq]=https://16to10.com` |
| `publishedAt` | datetime | é«˜ | æ—¶é—´ç´¢å¼• | `sort=publishedAt:desc` |
| `title` | string | ä¸­ | å…¨æ–‡ç´¢å¼• | `filters[title][$contains]=strapi` |
| `username` | string | ä¸­ | å”¯ä¸€ç´¢å¼• | `filters[username][$eq]=author1` |

### âœ… æ¨èå¤åˆç´¢å¼•

```sql
-- æœ€å¸¸ç”¨æŸ¥è¯¢ç»„åˆ
CREATE INDEX idx_articles_lang_domain_published ON articles(language, domain, publishedAt DESC);

-- è¯­è¨€ + æ—¶é—´æ’åº
CREATE INDEX idx_articles_lang_published ON articles(language, publishedAt DESC);

-- åŸŸå + æ—¶é—´æ’åº  
CREATE INDEX idx_articles_domain_published ON articles(domain, publishedAt DESC);
```

## å¸¸ç”¨æŸ¥è¯¢æ¨¡å¼

### 1. æ–‡ç« åˆ—è¡¨æŸ¥è¯¢ (æœ€å¸¸ç”¨)

```javascript
// åŸºç¡€æŸ¥è¯¢ - æ€§èƒ½ä¼˜ç§€
GET /api/articles?filters[language][$eq]=ja&sort=publishedAt:desc&pagination[page]=1&pagination[pageSize]=10

// å¤šæ¡ä»¶æŸ¥è¯¢ - æ€§èƒ½è‰¯å¥½
GET /api/articles?filters[language][$eq]=ja&filters[domain][$eq]=https://16to10.com&sort=publishedAt:desc

// æœç´¢æŸ¥è¯¢ - æ€§èƒ½ä¸€èˆ¬
GET /api/articles?filters[title][$containsi]=æ•°å­¦&filters[language][$eq]=ja
```

**ç´¢å¼•éœ€æ±‚**: `(language, domain, publishedAt)`

### 2. ä½œè€…ç›¸å…³æŸ¥è¯¢

```javascript
// æŒ‰ä½œè€…æŸ¥è¯¢æ–‡ç«  - æ€§èƒ½è‰¯å¥½
GET /api/articles?filters[author][id][$eq]=1&sort=publishedAt:desc

// ä½œè€…ä¿¡æ¯æŸ¥è¯¢ - æ€§èƒ½ä¼˜ç§€
GET /api/authors?filters[username][$eq]=author1
```

**ç´¢å¼•éœ€æ±‚**: `author_id`, `username`

### 3. æ—¶é—´èŒƒå›´æŸ¥è¯¢

```javascript
// æ—¶é—´èŒƒå›´ - æ€§èƒ½ä¼˜ç§€
GET /api/articles?filters[publishedAt][$gte]=2023-01-01&filters[publishedAt][$lte]=2023-12-31

// æœ€è¿‘æ–‡ç«  - æ€§èƒ½ä¼˜ç§€
GET /api/articles?filters[publishedAt][$gte]=2023-12-01&sort=publishedAt:desc
```

**ç´¢å¼•éœ€æ±‚**: `publishedAt`

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ğŸš€ æŸ¥è¯¢ä¼˜åŒ–

1. **ä¼˜å…ˆä½¿ç”¨ç´¢å¼•å­—æ®µè¿‡æ»¤**
   ```javascript
   // âœ… æ¨è - ä½¿ç”¨ç´¢å¼•å­—æ®µ
   filters[language][$eq]=ja
   filters[domain][$eq]=https://16to10.com
   
   // âš ï¸ è°¨æ…ä½¿ç”¨ - æ€§èƒ½è¾ƒä½
   filters[title][$contains]=strapi
   filters[tags][$contains]=æ•°å­¦
   ```

2. **åˆç†è®¾ç½®åˆ†é¡µå¤§å°**
   ```javascript
   // âœ… æ¨è
   pagination[pageSize]=10  // åˆ—è¡¨é¡µ
   pagination[pageSize]=25  // ç®¡ç†é¡µ
   
   // âŒ é¿å…
   pagination[pageSize]=100 // è¿‡å¤§å½±å“æ€§èƒ½
   ```

3. **é¿å…æ·±åº¦å…³è”æŸ¥è¯¢**
   ```javascript
   // âœ… æ¨è
   populate=author
   
   // âš ï¸ è°¨æ…ä½¿ç”¨
   populate[author][populate]=profile
   ```

### ğŸ“Š ç¼“å­˜ç­–ç•¥

```javascript
// ç¼“å­˜æ—¶é—´å»ºè®®
const cacheTTL = {
  articles: 300,      // 5åˆ†é’Ÿ - æ–‡ç« åˆ—è¡¨
  article: 1800,      // 30åˆ†é’Ÿ - å•ç¯‡æ–‡ç« 
  authors: 3600,      // 1å°æ—¶ - ä½œè€…ä¿¡æ¯
  search: 60          // 1åˆ†é’Ÿ - æœç´¢ç»“æœ
};
```

### ğŸ” ç›‘æ§æŒ‡æ ‡

- **å“åº”æ—¶é—´**: < 200ms (ç›®æ ‡)
- **ç¼“å­˜å‘½ä¸­ç‡**: > 85%
- **æ•°æ®åº“è¿æ¥**: < 80% ä½¿ç”¨ç‡

## æŸ¥è¯¢æ„å»ºå™¨ç¤ºä¾‹

```javascript
// æ¨èçš„å‰ç«¯æŸ¥è¯¢æ„å»ºå™¨
class ArticleQuery {
  constructor() {
    this.filters = {};
    this.sort = 'publishedAt:desc';
    this.pagination = { page: 1, pageSize: 10 };
    this.populate = [];
  }
  
  // è¯­è¨€è¿‡æ»¤ (é«˜ä¼˜å…ˆçº§ç´¢å¼•)
  byLanguage(lang) {
    this.filters.language = { $eq: lang };
    return this;
  }
  
  // åŸŸåè¿‡æ»¤ (é«˜ä¼˜å…ˆçº§ç´¢å¼•)
  byDomain(domain) {
    this.filters.domain = { $eq: domain };
    return this;
  }
  
  // æ ‡é¢˜æœç´¢ (å…¨æ–‡ç´¢å¼•)
  searchTitle(keyword) {
    this.filters.title = { $containsi: keyword };
    return this;
  }
  
  // æ—¶é—´èŒƒå›´ (æ—¶é—´ç´¢å¼•)
  byDateRange(start, end) {
    this.filters.publishedAt = { $gte: start, $lte: end };
    return this;
  }
  
  // æ’åº (ç´¢å¼•å­—æ®µ)
  sortBy(field, direction = 'desc') {
    this.sort = `${field}:${direction}`;
    return this;
  }
  
  // åˆ†é¡µ
  paginate(page, size) {
    this.pagination = { page, pageSize: size };
    return this;
  }
  
  // æ„å»ºæŸ¥è¯¢å‚æ•°
  build() {
    const params = new URLSearchParams();
    
    // æ·»åŠ è¿‡æ»¤æ¡ä»¶
    Object.entries(this.filters).forEach(([field, condition]) => {
      Object.entries(condition).forEach(([op, value]) => {
        params.append(`filters[${field}][${op}]`, value);
      });
    });
    
    // æ·»åŠ å…¶ä»–å‚æ•°
    params.append('sort', this.sort);
    params.append('pagination[page]', this.pagination.page);
    params.append('pagination[pageSize]', this.pagination.pageSize);
    
    if (this.populate.length > 0) {
      this.populate.forEach((rel, index) => {
        params.append(`populate[${index}]`, rel);
      });
    }
    
    return params.toString();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const query = new ArticleQuery()
  .byLanguage('ja')
  .byDomain('https://16to10.com')
  .sortBy('publishedAt', 'desc')
  .paginate(1, 10)
  .build();

// GET /api/articles?filters[language][$eq]=ja&filters[domain][$eq]=https://16to10.com&sort=publishedAt:desc&pagination[page]=1&pagination[pageSize]=10
```

## é”™è¯¯å¤„ç†

```javascript
// APIé”™è¯¯å¤„ç†
const handleAPIError = (error) => {
  if (error.status === 404) {
    console.warn('èµ„æºä¸å­˜åœ¨');
  } else if (error.status === 429) {
    console.warn('è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•');
  } else if (error.status >= 500) {
    console.error('æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
  }
};
```

## æ€»ç»“

### å…³é”®è¦ç‚¹
1. **ä¼˜å…ˆä½¿ç”¨é«˜ä¼˜å…ˆçº§ç´¢å¼•å­—æ®µ** (`language`, `domain`, `publishedAt`)
2. **åˆç†è®¾ç½®åˆ†é¡µå¤§å°** (10-25æ¡)
3. **å®æ–½é€‚å½“çš„ç¼“å­˜ç­–ç•¥**
4. **ç›‘æ§æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡**

### é¿å…çš„æ“ä½œ
1. âŒ å¤§é‡æ•°æ®çš„ `$contains` æŸ¥è¯¢
2. âŒ è¿‡å¤§çš„åˆ†é¡µå¤§å° (>50æ¡)
3. âŒ æ·±åº¦åµŒå¥—çš„å…³è”æŸ¥è¯¢
4. âŒ é¢‘ç¹çš„å®æ—¶æŸ¥è¯¢ (æ— ç¼“å­˜)

é€šè¿‡éµå¾ªè¿™äº›æŒ‡å—ï¼Œå¯ä»¥ç¡®ä¿å‰ç«¯æŸ¥è¯¢çš„é«˜æ€§èƒ½å’Œè‰¯å¥½ç”¨æˆ·ä½“éªŒã€‚
